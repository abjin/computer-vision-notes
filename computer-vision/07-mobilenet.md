# 경량 모델의 필요성

- ResNet 과 같은 깊은 모델은 정확도가 높지만 실시간/모바일 사용에는 너무 큼
- 모바일 앱 드론 AR 로보틱스에는 빠르고 가벼운 모델이 필요
- 정확도 - 속도 크기 간에 트레이드 오프가 필요


# 계산 비용 FLOPS 계산하기

- 깊이: 
	- 레이어 수
	- 계산 비용 선형적 증가
- 너비: 
	- 레이어당 채널 수
	- 계산 비용 제곱으로 증가
- 해상도: 
	- 입력 이미지의 크기
	- 계산 비용 제곱으로 증가

- Flops
	- Flops 는 부동 소수점 연산을 의미
	- 단일 곱셈 또는 덧셉은 1 Flops
	- Flops 는 딥러닝 모델의 계산 비용을 추정하는데 사용



# 모바일넷

- 개용
	- 모바일 및 임베디드를 위해서 개발됨
	- 객체 감지, 얼굴 인식, 지리적 위치 파악


- 핵심 아이디어
	- 깊이별 분리형 합성곱 (Deepwise separable convolution)
	- 유연한 스케일링을 위한 2개의 파라미터

# 표준 합성 곱 vs 깊이별 분리형 합성곱

**표준 합성곱**
- 하나의 필터가 모든 채널에 동시에 걸쳐있음
- 필터의 채널의 크기는 입력 채널 수와 같음


**깊이별 분리형 합성곱**
- 깊이 별 (Depthwise)
	- 각 채널 당 하나의 필터를 적용
	- 필터가 채널 별로 있음
	- 채널별로 conv 연산결과가 나옴
- 포인트 별(Pointwise)
	- 1 x 1 Conv 연산을 통해 결합된 아웃풋을 반환


**표준 합성 곱 vs 깊이별 분리형 합성곱**
- 표준 합성 곱은 공간 필터링 + 채널 믹싱을 한번에 수행
- 깊이별불리형합성곱은 두개의 단계로 나눠서 진행
	- 깊이별 합성곱: 입력 채널 별로 공간 필터링 적용
	- 점별 합성곱: 1x1 합성곱을 사용하여 출력 채널들을 믹싱
	- 이러한 분리는 계산량과 파라미터를 크게 줄임


# 표준 합성곱 계산량

- $D_{K}$: 커널 크기 (예: $3\rightarrow3\times3)$
- M: 입력 채널 수
- N: 출력 채널 수 (즉, 필터 수) 
- $D_{F}$: 입력 피처 맵의 공간 차원 
- $D_{G}$: 출력 피처 맵의 공간 차원
<br>
1. 같은 위치 같은 필터
	- 각 필터는 $D_{K}^{2}\times M$ 번의 곱셈을 수행
2. 모든 공간적 위치에서 같은 필터
	- 각 필터는 $D_{K}^{2}\times D_{G}^{2}\times M$ 번의 곱셈을 수행
3. 모든 필텅
	- 총 FLOPs $=D_{G}^{2}\times D_{K}^{2}\times M\times N$


# 깊이별 분리형 합성곱 계산량


- $D_{K}$: 커널 크기 (예: $3\rightarrow3\times3)$
- M: 입력 채널 수
- N: 출력 채널 수 (즉, 필터 수) 
- $D_{F}$: 입력 피처 맵의 공간 차원 
- $D_{G}$: 출력 피처 맵의 공간 차원

- Depthwise
	- 각 M 개의 채널은 필터를 하나씩 갖음
	- 각 채널당: $D_{F}^{2}\times D_{K}^{2}$
	- 총합: $D_{F}^{2}\times D_{K}^{2}\times M$

- Pointwise
	- $D_F^2$ 포인트가 있음
	- 입력 행력의 깊이 만큼 곱샘 필요: M
	- 출력 행렬의 깊이 만큼 위 과정 반복: N
	- 총합: $M\times N\times D_{F}^{2}$


- Depthwise + Pointwise = $D_{F}^{2}\times D_{K}^{2}\times M$ + $M\times N\times D_{F}^{2}$


$$\frac{\text{Depthwise Separable Convolution}}{\text{Standard Convolution}} = \frac{D_{F}^{2}\times D_{K}^{2}\times M+M\times D_{F}^{2}}{D_{G}^{2}\times D_{K}^{2}\times M\times N} = \frac{M\times D_{F}^{2}(D_{K}^{2}+N)}{D_{G}^{2}\times D_{K}^{2}\times M\times N}$$
$$= \frac{M\times D_{G}^{2}(D_{K}^{2}+N)}{D_{G}^{2}\times D_{K}^{2}\times M\times N} = \frac{D_{K}^{2}+N}{D_{K}^{2}\times N} = \frac{1}{N}+\frac{1}{D_{K}^{2}}$$


